# üìå –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ AI-–ø–∞–π–ø–ª–∞–π–Ω—É
Orion Soft ‚Äî Internal AI Assistant
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## 1. –û–±–∑–æ—Ä
Visior ‚Äî –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –û–Ω –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç RAG (Retrieval-Augmented Generation), –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (doc ‚Üí section ‚Üí chunk), MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –¥–≤–æ–π–Ω–æ–π safety-–∫–æ–Ω—Ç—É—Ä –∏ OWASP-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é.

## 2. –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–°–ª–æ–∏ —Å–∏—Å—Ç–µ–º—ã:
1. **Client Layer** ‚Äî –≤–µ–±-UI, —á–∞—Ç-–±–æ—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
2. **Edge Layer** ‚Äî API Gateway, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, rate limit.
3. **Safety Layer (Input)** ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö/PII-–∑–∞–ø—Ä–æ—Å–æ–≤.
4. **AI Orchestrator** ‚Äî –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ (RAG, MCP, direct), –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —à–∞–≥–æ–≤.
5. **Retrieval Layer** ‚Äî Vector DB + keyword search + reranking.
6. **LLM Layer** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, tool-use, MCP loop.
7. **Safety Layer (Output)** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
8. **Response Layer** ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–¥–∞—á–∞ –≤ UI.
9. **Data Layer** ‚Äî Document Store, Metadata DB, policy store.

## 3. –°–∫–≤–æ–∑–Ω–æ–π –ø–æ—Ç–æ–∫ (User ‚Üí Answer)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å (web/—á–∞—Ç/–ø–æ—Ä—Ç–∞–ª).
2. API Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω, tenant, rate limit.
3. Input Safety –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (allowed / transformed / blocked).
4. AI Orchestrator —Å–æ–±–∏—Ä–∞–µ—Ç payload –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç RAG.
5. Retrieval Service –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞–Ω–∫–∏/—Å–µ–∫—Ü–∏–π –∏–∑ Vector DB.
6. Orchestrator —Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç LLM Service.
7. LLM Service –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MCP Tools Proxy.
8. –û—Ç–≤–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç Safety Output Guard.
9. API Gateway –æ—Ç–¥–∞—ë—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç + –∏—Å—Ç–æ—á–Ω–∏–∫–∏ + trace_id.

## 4. Safety Layer #1 ‚Äî Input Guard
**–ó–∞–¥–∞—á–∏:** Content Safety (OWASP LLM-01), DLP/PII, RBAC, tenant isolation, –∑–∞—â–∏—Ç–∞ –æ—Ç prompt injection.
**–î–µ–π—Å—Ç–≤–∏—è:**
- `allow` ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å.
- `transform` ‚Äî —É–¥–∞–ª—è–µ–º/–º–∞—Å–∫–∏—Ä—É–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- `block` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
**–¢–µ—Ö–Ω–∏–∫–∏:** rule-based + lightweight safety LLM, regex-–ø—Ä–∞–≤–∏–ª–∞, keyword scoring, OPA/Rego.

## 5. AI Orchestrator
**–§—É–Ω–∫—Ü–∏–∏:**
- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ (RAG, MCP tool-use, direct inference).
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω-–±—é–¥–∂–µ—Ç–æ–º –∏ —Ç–∞–π–º-–∞—É—Ç–∞–º–∏.
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ context builder'–∞.
- Fallback/—Ä–µ—Ç—Ä–∞–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö retrieval –∏–ª–∏ LLM.
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ (`trace_id`, latency, tool_steps).

## 6. Retrieval Layer
**Pipeline:** doc-level ‚Üí section-level ‚Üí chunk-level ‚Üí reranking.
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞:**
- Document: doc_embedding, metadata (–≥—Ä—É–±–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è).
- Section: summary + summary_embedding (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞).
- Chunk: —Ç–µ–∫—Å—Ç + embedding + —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
**Hybrid Search:** dense embeddings + BM25/keyword lookup + metadata boosting + cross-encoder reranking.
**Context Builder:**
- –ª–∏–º–∏—Ç –ø–æ —Ç–æ–∫–µ–Ω–∞–º (‚âà 4k ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤ —Å–∏–º–≤–æ–ª—ã);
- –±–∞–ª–∞–Ω—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–Ω–µ –±–æ–ª–µ–µ N chunk'–æ–≤ –Ω–∞ doc);
- —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å–µ–∫—Ü–∏–π.

## 7. LLM Layer + MCP
- LLM –ø–æ–ª—É—á–∞–µ—Ç system prompt + –∏—Å—Ç–æ—Ä–∏—é + context_chunks.
- MCP –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (read_section, read_file_range, search_index) –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ tool-call'–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–∞ –æ—Ç–≤–µ—Ç–∞.
- Trace —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ (tool name, args, result).

## 8. Safety Layer #2 ‚Äî Output Guard
**–ó–∞–¥–∞—á–∏:** –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—Ä–µ–¥–Ω–æ–≥–æ/–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ (OWASP LLM-02), —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ç–∏–ª—è –∏ –ø–æ–ª–∏—Ç–∏–∫–∏.
**–†–µ–∂–∏–º—ã:**
- `allow` ‚Äî –æ—Ç–≤–µ—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω.
- `sanitize` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å/–æ–±—Ä–µ–∑–∞—Ç—å –æ–ø–∞—Å–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
- `block` ‚Äî –≤–µ—Ä–Ω—É—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ—Ç–∫–∞–∑.
**–ü—Ä–∏—ë–º—ã:** keyword rules, PII redaction, –¥–æ–ø. safety LLM.

## 9. Response Layer
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.
- –£–∫–∞–∑–∞–Ω–∏–µ `trace_id`, latency, —Å—Ç–∞—Ç—É—Å–∞ safety.
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è UI (Markdown/plain text).
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ audit storage.

## 10. Ingestion Pipeline (Documents ‚Üí Index)
1. **Upload** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ object storage, —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å `doc_id`.
2. **Parsing** ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (sections/pages), —Ç–∞–±–ª–∏—Ü, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
3. **Chunking** ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Å–µ–∫—Ü–∏–∏/—á–∞–Ω–∫–∏.
4. **Summaries** ‚Äî LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç summary –¥–ª—è —Å–µ–∫—Ü–∏–π.
5. **Embeddings** ‚Äî –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–µ–∫—Ü–∏–π –∏ —á–∞–Ω–∫–æ–≤.
6. **Indexing** ‚Äî –∑–∞–ø–∏—Å—å –≤ Vector DB + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π –¥–ª—è MCP.
7. **Statuses/Events** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Document Service –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è `document_ingested`/`failed`.

## 11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ OWASP LLM Top-10 (LLM01‚ÄìLLM10).
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã / PII.
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ per-tenant.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º monitor-only (–ª–æ–≥–∏—Ä—É–µ–º, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º) –Ω–∞ —Å—Ç–µ–π–¥–∂–∏–Ω–≥–µ.

## 12. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Latency breakdown: gateway, safety, retrieval, llm, MCP.
- RAG –∫–∞—á–µ—Å—Ç–≤–æ: recall/precision –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ.
- –ò–Ω–≥–µ—Å—Ç–∏—è: —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫.
- Safety —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ/—Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.
- MCP usage: —á–∞—Å—Ç–æ—Ç–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –æ—à–∏–±–∫–∏.

## 13. –†–µ–∑—é–º–µ
–ü–∞–π–ø–ª–∞–π–Ω Visior –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º;
- –≥–∏–±–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π;
- –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π RAG –∑–∞ —Å—á—ë—Ç multi-stage retrieval;
- –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º —á–µ—Ä–µ–∑ MCP;
- –ø–æ–ª–Ω–æ—Ç—É –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (trace_id, –º–µ—Ç—Ä–∏–∫–∏, —Å–æ–±—ã—Ç–∏—è).
